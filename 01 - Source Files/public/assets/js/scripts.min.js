var hyperdrive=hyperdrive||{},data=$.localStorage;hyperdrive.dataController=function(){"use strict";var e=(data.get("raceMode")||null,data.get("currentModeRaces")||null,data.get("currentModeBestTime")||null,data.get("currentRaceIndex")||null,data.get("currentRace")||null,data.get("leaderboard")||null,function(e,t){function a(e){var t=188,a=130,r=50*e,n={OUTER:0,INNER:0};return r>50?(n.OUTER=100,n.INNER=2*(r-50)):(n.OUTER=2*r,n.INNER=0),n.OUTER=t*-1+t*(n.OUTER/100),n.INNER=a*-1+a*(n.INNER/100),n}function r(e,t){var a=parseFloat(e);return"number"!=typeof a&&(a=0),a}function i(e,t){return e.NETLAP.VALUE-t.NETLAP.VALUE}function c(e,t){return e.RACENO-t.RACENO}for(var o,d={TT:{RACES:[],BEST_RUN:{TIME:0}},RR:{RACES:[],BEST_RUN:{TIME:0}}},l={},s=e.length<10?d.length:9,E=1;E<s;E++)o=e[E],l={RACE_MODE:o[0],MODE_PLACE:{POSITION:0,LABEL:""},TARGET_TIME:o[1],RECORD_TIME:{VALUE:o[2],CHANGE:"",CHANGE_VALUE:0},DRAG_COEFFICIENT:o[3],PEAK_WHEELSPEED:o[4],LAST_RACE_TIME:{VALUE:0,CHANGE:"",CHANGE_VALUE:0},RACENO:o[5],LANE:o[6],REACTIONTIME:{TIME:r(o[7].split("|")[0],3),TIME_PERCENT:50*o[7].split("|")[0]||0,VALUE:r(o[7].split("|")[1],3)},ACCELERATION:{TIME:r(o[8].split("|")[0],3),TIME_PERCENT:50*o[8].split("|")[0],VALUE:r(o[8].split("|")[1],3)},RUNOUT:{TIME:r(o[9].split("|")[0],3),TIME_PERCENT:50*o[9].split("|")[0],VALUE:r(o[9].split("|")[1],3)},GROSSLAP:{TIME:r(o[10].split("|")[0],3),TIME_PERCENT:50*o[10].split("|")[0],VALUE:r(o[10].split("|")[1],3)},STOPTIME:{TIME:r(o[11].split("|")[0],3),TIME_PERCENT:50*o[11].split("|")[0],VALUE:r(o[11].split("|")[1],3)},NETLAP:{VALUE:r(o[12],3),DIAGRAM:a(o[12])},PENALTIES:{VALUE:o[13].split("|")[0]||0,LABEL:o[13].split("|")[1]},LERS_ADVANTAGE:o[14],THRUSTFORCE:{VALUE:o[15],DIFF:"UP",CHANGE:""},LIFTFORCE:{VALUE:o[16],DIFF:"DOWN",CHANGE:""},DOWNFORCE:{VALUE:o[17],DIFF:"DOWN",CHANGE:""},TETHERLINE_FORCE:{VALUE:o[18],DIFF:"DOWN",CHANGE:""},BEARINGWEAR:{PEAK:o[19],LAPS:0},VELOCITY:null},d[l.RACE_MODE].RACES[l.RACENO-1]=l;$.each(d,function(e,t){d[e].RACES.sort(i);for(var a=0;a<t.RACES.length;a++)d[e].RACES[a].MODE_PLACE.POSITION=a+1,0===a?(d[e].RACES[a].MODE_PLACE.LABEL="best",d[e].BEST_RUN.TIME=d[e].RACES[a].NETLAP.VALUE):a===t.length-1&&(d[e].RACES[a].MODE_PLACE.LABEL="worst");d[e].RACES.sort(c)}),console.log(d),data.set("races",d),n("TT",0)}),t=function(e,t,a){var r=a.split("-")[0],n=a.split("-")[1];if(data.isSet("races."+r)){var i=data.get("races."+r+".RACES").findIndex(function(e){return e.RACENO===n});if(i>-1){e.splice(0,1);var c=data.get("races");c[r].RACES[i].VELOCITY=e,data.set("races",c)}else console.error("No race found for "+a)}else console.error("No races found for "+r)},a=function(e,t){for(var a,r=[],n={},i={RACE:{best:parseFloat(e[1][1]),diff:0},GP:{best:parseFloat(e[1][2]),diff:0}},c=1;c<e.length;c++)a=e[c],i.RACE.diff=parseFloat(a[1])-i.RACE.best,i.GP.diff=parseFloat(a[2])-i.GP.best,n={NAME:a[0],RACE:{TIME:parseFloat(a[1]),DIFF:i.RACE.diff.toFixed(4)},GP:{TIME:parseFloat(a[2]),DIFF:i.GP.diff.toFixed(4)}},r.push(n);data.set("leaderboard",r)},r=function(e,t){data.set("raceMode",e),data.set("currentModeRaces",data.get("races")[e].RACES),data.set("currentModeBestTime",data.get("races")[e].BEST_RUN.TIME),t&&hyperdrive.router.reloadPage()},n=function(e,t,a){data.set("currentRaceIndex",t),data.set("currentRace",data.get("races")[e].RACES[parseInt(t,0)]),r(e),a&&hyperdrive.router.reloadPage()},i=function(){data.removeAll(),$(".form-upload-csv-files")[0].reset()},c=function(){console.log("dataController.init"),data.isSet("races")?(n("TT",0),console.log("Races"),console.log(data.get("races"))):page.redirect("/"),$(document).on("click",".js-page-links a",function(e){e.preventDefault(),page($(this).attr("href")||$(this).attr("xlink:href"))}),$(document).on("click",".js-set-current-race",function(e){e.preventDefault();var t=$(this).closest("li");if(t.hasClass("active")===!1&&t.hasClass("disabled")===!1){var a=$(this).attr("href").split("-");hyperdrive.dataController.setCurrentRace(a[0].replace("#",""),a[1],!0)}}),$(document).on("click",".js-set-race-mode",function(e){e.preventDefault();var t=$(this).closest("li");t.hasClass("active")===!1&&hyperdrive.dataController.setCurrentRace($(this).attr("href").replace("#",""),0,!0)}),$(document).on("click",".js-clear-all-data",function(e){e.preventDefault(),window.confirm("Clear all app data?")&&i()})};return{init:c,setRaceMode:r,setCurrentRace:n,sortRaceData:e,sortRaceVelocity:t,sortLeaderboard:a}}(),hyperdrive.siteHeader=function(){"use strict";var e=$(".site-header"),t=e.find(".js-page-links"),a=e.find(".js-page-name"),r=e.find(".js-page-number"),n="",i=function(e){t.find("a.active").removeClass("active"),t.find('a[data-page-number="'+e+'"]').addClass("active")},c=function(e){switch(e){case"dashboard":n="";break;case"graph":n="01";break;case"timing":n="02";break;case"analysis":n="03";break;case"social":n="04";break;default:n=""}i(n),a.text(e),r.text(n)},o=function(){console.log("siteHeader.init")};return{init:o,updateSiteHeader:c}}(),hyperdrive.pageDashboard=function(){"use strict";var e,t,a,r,n,i,c=function(){t=data.get("raceMode")||"TT",a=data.get("currentRaceIndex")||0,r=data.get("currentModeRaces")||null,n=data.get("currentRace")||null,i=data.get("leaderboard")||null,o()},o=function(){e=$("#page-dashboard").render(),$("#page-container").html(e)},d=function(e){console.log("pageDashboard.parseCSV");var t=$(e);t.parse({config:{complete:function(e,a){if(e.errors.length>0)for(var r=0;r<e.errors.length;r++)console.error("CSV ERROR:",e.errors[r]);else t.hasClass("csv-races")&&hyperdrive.dataController.sortRaceData(e.data,a),t.hasClass("csv-race-graph")&&hyperdrive.dataController.sortRaceVelocity(e.data,a,t.attr("id")),t.hasClass("csv-leaderboard")&&hyperdrive.dataController.sortLeaderboard(e.data,a)}},complete:function(){}})},l=function(){console.log("dashboard.init"),$(document).on("change",".csv-file-input",function(e){console.log("file changed"),d(this)})};return{init:l,loadPage:c}}(),hyperdrive.pageGraph=function(){"use strict";var e,t,a,r,n,i,c=function(){t=data.get("raceMode")||"TT",a=data.get("currentRaceIndex")||0,r=data.get("currentModeRaces")||null,n=data.get("currentRace")||null,i=data.get("leaderboard")||null,o()},o=function(){e=$("#page-graph").render({raceMode:t,currentRaceIndex:a,currentRace:n}),$("#page-container").html(e),n&&d()},d=function(){function e(){return d3.axisLeft(s).ticks(35)}function t(){return d3.axisLeft(s).ticks(6)}function a(){return d3.axisBottom(l).ticks(12).tickSize(10).tickPadding(5)}function r(){return d3.axisBottom(l).ticks(120).tickSize(4).tickPadding(5).tickFormat("")}var i=n.VELOCITY,c={top:20,right:20,bottom:42,left:85},o=980-c.left-c.right,d=315-c.top-c.bottom,l=d3.scaleLinear().domain([0,2]).range([0,o]),s=d3.scaleLinear().domain([0,30]).range([d,0]),E=(d3.line().x(function(e){return x(e)}).y(function(e){return y(e)}),d3.select("#velocity-graph").append("svg").attrs({width:o+c.left+c.right,height:d+c.top+c.bottom}).append("g").attrs({transform:"translate("+c.left+","+c.top+")"}));E.append("rect").attrs({"class":"graph-bg",width:o,height:d}),E.append("g").attrs({"class":"grid-lines"}).call(e().tickSize(-o).tickFormat("")),E.append("g").attrs({"class":"axis axis-left"}).call(t()),E.append("g").attrs({"class":"axis axis-bottom",transform:"translate(0, "+(d+10)+")"}).call(a()),E.append("g").attrs({"class":"axis axis-bottom-small",transform:"translate(0, "+(d+10)+")"}).call(r());var u=d3.line().x(function(e){return l(e[0])}).y(function(e){return s(e[1])}),p=d3.area().x(function(e){return l(e[0])}).y1(function(e){return s(e[1])}).y0(s(0)),g=7;n.VELOCITY&&(n.REACTIONTIME&&E.append("path").datum(i.filter(function(e){return e[0]<n.REACTIONTIME.TIME})).attr("class","graph-area area-reaction").attr("d",p),E.append("path").datum(i.filter(function(e){return n.REACTIONTIME?e[0]>=n.REACTIONTIME.TIME&&e[0]<=n.ACCELERATION.TIME:e[0]<n.ACCELERATION.TIME})).attr("class","graph-area area-acceleration").attr("d",p),E.append("path").datum(i.filter(function(e){return e[0]>=n.ACCELERATION.TIME&&e[0]<=n.RUNOUT.TIME})).attr("class","graph-area area-runout").attr("d",p),E.append("path").datum(i.filter(function(e){return e[0]>=n.RUNOUT.TIME&&e[0]<=n.GROSSLAP.TIME})).attr("class","graph-area area-coasting").attr("d",p),E.append("path").datum(i.filter(function(e){return e[0]>=n.GROSSLAP.TIME})).attr("class","graph-area area-deceleration").attr("d",p),n.REACTIONTIME&&E.append("path").datum(i.filter(function(e){return e[0]<n.REACTIONTIME.TIME})).attr("class","graph-line line-reaction").attr("d",u),E.append("path").datum(i.filter(function(e){return n.REACTIONTIME?e[0]>=n.REACTIONTIME.TIME&&e[0]<=n.ACCELERATION.TIME:e[0]<n.ACCELERATION.TIME})).attr("class","graph-line line-acceleration").attr("d",u),E.append("path").datum(i.filter(function(e){return e[0]>=n.ACCELERATION.TIME&&e[0]<=n.RUNOUT.TIME})).attr("class","graph-line line-runout").attr("d",u),E.append("path").datum(i.filter(function(e){return e[0]>=n.RUNOUT.TIME&&e[0]<=n.GROSSLAP.TIME})).attr("class","graph-line line-coasting").attr("d",u),E.append("path").datum(i.filter(function(e){return e[0]>=n.GROSSLAP.TIME})).attr("class","graph-line line-deceleration").attr("d",u)),n.REACTIONTIME&&E.append("circle").attrs({"class":"graph-circle circle-reaction",cx:l(n.REACTIONTIME.TIME),cy:s(n.REACTIONTIME.VALUE),r:g,"data-hover-info":"Reaction Time|"+n.REACTIONTIME.TIME+"|"+n.REACTIONTIME.VALUE}),E.append("circle").attrs({"class":"graph-circle circle-acceleration",cx:l(n.ACCELERATION.TIME),cy:s(n.ACCELERATION.VALUE),r:g,"data-hover-info":"Accelleration|"+n.ACCELERATION.TIME+"|"+n.ACCELERATION.VALUE}),E.append("circle").attrs({"class":"graph-circle circle-runout",cx:l(n.RUNOUT.TIME),cy:s(n.RUNOUT.VALUE),r:g,"data-hover-info":"Run Out|"+n.RUNOUT.TIME+"|"+n.RUNOUT.VALUE}),E.append("circle").attrs({"class":"graph-circle circle-deceleration",cx:l(n.GROSSLAP.TIME),cy:s(n.GROSSLAP.VALUE),r:g,"data-hover-info":"Gross Lap|"+n.GROSSLAP.TIME+"|"+n.GROSSLAP.VALUE});var T=$(".stage-container");n.REACTIONTIME?(T.find(".bar-reaction").css({width:l(n.REACTIONTIME.TIME)+"px"}),T.find(".bar-acceleration").css({width:l(n.ACCELERATION.TIME)-l(n.REACTIONTIME.TIME)+"px"})):(T.find(".bar-reaction").css({width:"0px"}),T.find(".bar-acceleration").css({width:l(n.ACCELERATION.TIME)+"px"})),T.find(".bar-runout").css({width:l(n.RUNOUT.TIME)-l(n.ACCELERATION.TIME)+"px"}),T.find(".bar-coasting").css({width:l(n.GROSSLAP.TIME)-l(n.RUNOUT.TIME)+"px"}),T.find(".bar-deceleration").css({width:T.width()-l(n.GROSSLAP.TIME)+"px"})},l=function(e,t){var a="undefined"!=typeof t?t:1,r=$("#graph-tooltip"),n=e.getBoundingClientRect(),i=$(e).attr("data-hover-info").split("|");if(r.hide(),a){var c=i[0],o=i[1],d=i[2];"null"!==c&&"null"!==o&&"null"!==d&&(r.find(".js-tooltip-name").text(c),r.find(".js-tooltip-time").text(o),r.find(".js-tooltip-value").text(d),r.css({left:n.left+6,top:n.top-32}).show())}},s=function(){console.log("graph.init"),$(document).on("mouseenter","#velocity-graph .graph-circle",function(e){l(this)}),$(document).on("mouseleave","#velocity-graph .graph-circle",function(e){l(this,!1)})};return{init:s,loadPage:c}}(),hyperdrive.pageTiming=function(){"use strict";var e,t,a,r,n,i,c,o=function(){t=data.get("raceMode")||"TT",a=data.get("currentRaceIndex")||0,r=data.get("currentModeRaces")||null,n=data.get("currentModeBestTime")||null,i=data.get("currentRace")||null,c=data.get("leaderboard")||null,d()},d=function(){e=$("#page-timing").render({raceMode:t,currentModeRaces:r,currentModeBestTime:n,leaderboard:c}),$("#page-container").html(e),console.log("currentModeBestTime",n)},l=function(){console.log("timing.init")};return{init:l,loadPage:o}}(),hyperdrive.pageAnalysis=function(){"use strict";var e,t,a,r,n,i,c,o=function(){t=data.get("raceMode")||"TT",a=data.get("currentRaceIndex")||0,r=data.get("currentModeRaces")||null,n=data.get("currentModeBestTime")||null,i=data.get("currentRace")||null,c=data.get("leaderboard")||null,d()},d=function(){e=$("#page-analysis").render({raceMode:t,currentRaceIndex:a,currentModeBestTime:n,currentRace:i}),$("#page-container").html(e)},l=function(){console.log("analysis.init")};return{init:l,loadPage:o}}(),hyperdrive.pageSocial=function(){"use strict";var e,t,a,r,n,i,c=function(){t=data.get("raceMode")||"TT",a=data.get("currentRaceIndex")||0,r=data.get("currentModeRaces")||null,n=data.get("currentRace")||null,i=data.get("leaderboard")||null,o()},o=function(){e=$("#page-social").render(),$("#page-container").html(e)},d=function(){console.log("social.init")};return{init:d,loadPage:c}}(),hyperdrive.router=function(){"use strict";var e=null,t="/",a=function(a){e=a,t=a.path,console.log(a)},r=function(){console.log("reloadPage",t),page(t)},n=function(){console.log("router.init"),page("/",function(e){hyperdrive.siteHeader.updateSiteHeader("dashboard"),hyperdrive.pageDashboard.loadPage(),a(e)}),page("/graph",function(e){hyperdrive.siteHeader.updateSiteHeader("graph"),hyperdrive.pageGraph.loadPage(),a(e)}),page("/timing",function(e){hyperdrive.siteHeader.updateSiteHeader("timing"),hyperdrive.pageTiming.loadPage(),a(e)}),page("/analysis",function(e){hyperdrive.siteHeader.updateSiteHeader("analysis"),hyperdrive.pageAnalysis.loadPage(),a(e)}),page("/social",function(e){hyperdrive.siteHeader.updateSiteHeader("social"),hyperdrive.pageSocial.loadPage(),a(e)}),page("*",function(){page.redirect("/")}),page()};return{init:n,reloadPage:r}}(),$(document).ready(function(){hyperdrive.dataController.init(),hyperdrive.siteHeader.init(),hyperdrive.pageDashboard.init(),hyperdrive.pageGraph.init(),hyperdrive.pageTiming.init(),hyperdrive.pageAnalysis.init(),hyperdrive.pageSocial.init(),hyperdrive.router.init()});
//# sourceMappingURL=components.js.map
